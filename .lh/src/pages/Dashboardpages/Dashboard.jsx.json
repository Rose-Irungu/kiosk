{
    "sourceFile": "src/pages/Dashboardpages/Dashboard.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1755247318354,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755273521902,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n             />\r\n           }\r\n         />\r\n         <Card1\r\n-          cardTitle=\"Unresolved Incidents\"\r\n+          cardTitle=\" Incidents\"\r\n           count={loading ? \"...\" : stats?.incidents_in_progress?.total || 0}\r\n           link=\"View details\"\r\n           linkHref=\"/incident_report\"\r\n           icon={\r\n"
                },
                {
                    "date": 1755274399008,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n             />\r\n           }\r\n         />\r\n         <Card1\r\n-          cardTitle=\" Incidents\"\r\n+          cardTitle=\"Active Incidents\"\r\n           count={loading ? \"...\" : stats?.incidents_in_progress?.total || 0}\r\n           link=\"View details\"\r\n           linkHref=\"/incident_report\"\r\n           icon={\r\n"
                },
                {
                    "date": 1755699293852,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n         <div className=\"flex-1 lg:max-w-sm\">\r\n           <div className=\"bg-white p-3 rounded-lg shadow h-full\">\r\n             <Card3\r\n               companyVisitors={\r\n-                loading ? 0 : stats?.visitor_trend?.totals?.company_visitor || 0\r\n+                loading ? 0 : stats?.visitor_trend?.totals?. || 0\r\n               }\r\n               residentVisitors={\r\n                 loading ? 0 : stats?.visitor_trend?.totals?.visitor || 0\r\n               }\r\n"
                },
                {
                    "date": 1755699300029,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n         <div className=\"flex-1 lg:max-w-sm\">\r\n           <div className=\"bg-white p-3 rounded-lg shadow h-full\">\r\n             <Card3\r\n               companyVisitors={\r\n-                loading ? 0 : stats?.visitor_trend?.totals?. || 0\r\n+                loading ? 0 : stats?.visitor_trend?.totals?.company || 0\r\n               }\r\n               residentVisitors={\r\n                 loading ? 0 : stats?.visitor_trend?.totals?.visitor || 0\r\n               }\r\n"
                },
                {
                    "date": 1755699306282,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -156,9 +156,9 @@\n               companyVisitors={\r\n                 loading ? 0 : stats?.visitor_trend?.totals?.company || 0\r\n               }\r\n               residentVisitors={\r\n-                loading ? 0 : stats?.visitor_trend?.totals?.visitor || 0\r\n+                loading ? 0 : stats?.visitor_trend?.totals?.guest || 0\r\n               }\r\n               serviceProviders={\r\n                 loading ? 0 : stats?.visitor_trend?.totals?.service_provider || 0\r\n               }\r\n"
                },
                {
                    "date": 1755699311625,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -159,9 +159,9 @@\n               residentVisitors={\r\n                 loading ? 0 : stats?.visitor_trend?.totals?.guest || 0\r\n               }\r\n               serviceProviders={\r\n-                loading ? 0 : stats?.visitor_trend?.totals?.service_provider || 0\r\n+                loading ? 0 : stats?.visitor_trend?.totals?.service || 0\r\n               }\r\n               className=\"h-full\"\r\n             />\r\n           </div>\r\n"
                },
                {
                    "date": 1756017155269,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,9 @@\n \r\n   const {\r\n     stats: visitorStats,\r\n     loading: visitorLoading,\r\n-    error: visitorError,\r\n+    error: ,\r\n   } = useVisitorStats();\r\n \r\n   const getData = async () => {\r\n     try {\r\n"
                }
            ],
            "date": 1755247318354,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from \"react\";\r\n\r\nimport Layout from \"../../components/layout/Layout\";\r\nimport Card1 from \"../../components/Card1\";\r\nimport Card2 from \"../../components/Card2\";\r\nimport Card3 from \"../../components/Card3\";\r\nimport Chart from \"../../components/Chart\";\r\nimport DashboardTable from \"../../components/tables/DashboardTable\";\r\nimport { getDashboardStatistics } from \"../../services/dashboardService\";\r\nimport useVisitorStats from \"../../hooks/useVisitorStats\";\r\nimport { fetchEmergencies } from \"../../services/adminEmergencyServices\";\r\n\r\nconst Dashboard = () => {\r\n  const [stats, setStats] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [latest, setLatest] = useState(null);\r\n\r\n  const {\r\n    stats: visitorStats,\r\n    loading: visitorLoading,\r\n    error: visitorError,\r\n  } = useVisitorStats();\r\n\r\n  const getData = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      const { all } = await fetchEmergencies();\r\n\r\n      const ongoingOnly = all.filter(\r\n        (e) => e.emergency_status?.toLowerCase() === \"ongoing\"\r\n      );\r\n\r\n      setLatest(ongoingOnly.length > 0 ? ongoingOnly[0] : null);\r\n    } catch (err) {\r\n      console.error(\"Error fetching emergencies:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchStats = async () => {\r\n      try {\r\n        const data = await getDashboardStatistics();\r\n        setStats(data);\r\n      } catch (error) {\r\n        console.error(\"Failed to load dashboard stats:\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    getData();\r\n    fetchStats();\r\n  }, []);\r\n\r\n  console.log(stats);\r\n  console.log(\"Visitor stats:\", visitorStats);\r\n\r\n  return (\r\n    <Layout>\r\n      <div className=\"flex flex-wrap justify-start mb-[12px]\">\r\n        <Card1\r\n          cardTitle=\"Current Visitors\"\r\n          count={visitorLoading ? \"...\" : stats?.current_visitors?.count}\r\n          link=\"View log\"\r\n          linkHref=\"/visitorlogs\"\r\n          icon={\r\n            <img\r\n              src=\"/doorbell.svg\"\r\n              alt=\"Doorbell Icon\"\r\n              className=\"w-6 h-6 object-contain\"\r\n            />\r\n          }\r\n        />\r\n        <Card1\r\n          cardTitle=\"Unresolved Incidents\"\r\n          count={loading ? \"...\" : stats?.incidents_in_progress?.total || 0}\r\n          link=\"View details\"\r\n          linkHref=\"/incident_report\"\r\n          icon={\r\n            <img\r\n              src=\"/active.svg\"\r\n              alt=\"Incidents Icon\"\r\n              className=\"w-6 h-6 object-contain\"\r\n            />\r\n          }\r\n        />\r\n        <Card1\r\n          cardTitle=\"Emergencies Today\"\r\n          count={\r\n            loading ? \"...\" : stats?.emergencies?.stats?.today_emergencies || 0\r\n          }\r\n          link=\"View details\"\r\n          linkHref=\"/emergencypage\"\r\n          icon={\r\n            <img\r\n              src=\"/911.svg\"\r\n              alt=\"Emergency Icon\"\r\n              className=\"w-6 h-6 object-contain\"\r\n            />\r\n          }\r\n        />\r\n        <Card1\r\n          cardTitle=\"Total Active Users\"\r\n          count={loading ? \"...\" : stats?.users?.total || 0}\r\n          link=\"View users\"\r\n          linkHref=\"/userspage\"\r\n          icon={\r\n            <img\r\n              src=\"/users.svg\"\r\n              alt=\"Users Icon\"\r\n              className=\"w-6 h-6 object-contain\"\r\n            />\r\n          }\r\n        />\r\n      </div>\r\n\r\n      {visitorError && (\r\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\">\r\n          {visitorError}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mb-[30px]\">\r\n        {latest ? (\r\n          <Card2\r\n            id={latest?.id}\r\n            floor={latest?.triggerer_floor_number}\r\n            unit={latest?.triggerer_unit_number}\r\n            minute={latest?.created_at}\r\n            name={latest?.triggered_by}\r\n            status={latest?.emergency_status}\r\n            buttonText=\"View details\"\r\n            onResolved={getData}\r\n          />\r\n        ) : (\r\n          <div className=\"bg-white p-6 rounded shadow w-full\">\r\n            <p className=\"text-center text-gray-600 font-semibold\">\r\n              No unresolved emergencies\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"w-full flex flex-col lg:flex-row gap-6 mb-8\">\r\n        <div className=\"bg-white p-3 rounded-lg shadow flex-1\">\r\n          <div className=\"h-full\">\r\n            <Chart />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex-1 lg:max-w-sm\">\r\n          <div className=\"bg-white p-3 rounded-lg shadow h-full\">\r\n            <Card3\r\n              companyVisitors={\r\n                loading ? 0 : stats?.visitor_trend?.totals?.company_visitor || 0\r\n              }\r\n              residentVisitors={\r\n                loading ? 0 : stats?.visitor_trend?.totals?.visitor || 0\r\n              }\r\n              serviceProviders={\r\n                loading ? 0 : stats?.visitor_trend?.totals?.service_provider || 0\r\n              }\r\n              className=\"h-full\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <DashboardTable />\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n"
        }
    ]
}